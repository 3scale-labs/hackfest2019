apiVersion: template.openshift.io/v1
kind: Template
message: Login on https://${TENANT_NAME}-admin.${WILDCARD_DOMAIN} as ${ADMIN_USERNAME}/${ADMIN_PASSWORD}
metadata:
  annotations:
    description: 3scale API Management main system (Evaluation)
    iconClass: icon-3scale
    openshift.io/display-name: 3scale API Management
    openshift.io/provider-display-name: Red Hat, Inc.
    tags: integration, api management, 3scale
  creationTimestamp: null
  name: 3scale-api-management-eval
objects:
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    annotations:
      openshift.io/display-name: AMP APIcast
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
    name: amp-apicast
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
        openshift.io/display-name: AMP APIcast (latest)
      from:
        kind: ImageStreamTag
        name: ${AMP_RELEASE}
      generation: null
      importPolicy: {}
      name: latest
      referencePolicy:
        type: ""
    - annotations:
        openshift.io/display-name: AMP APIcast ${AMP_RELEASE}
      from:
        kind: DockerImage
        name: ${AMP_APICAST_IMAGE}
      generation: null
      importPolicy:
        insecure: ${{IMAGESTREAM_TAG_IMPORT_INSECURE}}
      name: ${AMP_RELEASE}
      referencePolicy:
        type: ""
  status:
    dockerImageRepository: ""
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    annotations:
      openshift.io/display-name: AMP System
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: amp-system
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
        openshift.io/display-name: AMP System (latest)
      from:
        kind: ImageStreamTag
        name: ${AMP_RELEASE}
      generation: null
      importPolicy: {}
      name: latest
      referencePolicy:
        type: ""
    - annotations:
        openshift.io/display-name: AMP system ${AMP_RELEASE}
      from:
        kind: DockerImage
        name: ${AMP_SYSTEM_IMAGE}
      generation: null
      importPolicy:
        insecure: ${{IMAGESTREAM_TAG_IMPORT_INSECURE}}
      name: ${AMP_RELEASE}
      referencePolicy:
        type: ""
  status:
    dockerImageRepository: ""
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    annotations:
      openshift.io/display-name: System Memcached
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-memcached
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
        openshift.io/display-name: System Memcached (latest)
      from:
        kind: ImageStreamTag
        name: ${AMP_RELEASE}
      generation: null
      importPolicy: {}
      name: latest
      referencePolicy:
        type: ""
    - annotations:
        openshift.io/display-name: System ${AMP_RELEASE} Memcached
      from:
        kind: DockerImage
        name: ${MEMCACHED_IMAGE}
      generation: null
      importPolicy:
        insecure: ${{IMAGESTREAM_TAG_IMPORT_INSECURE}}
      name: ${AMP_RELEASE}
      referencePolicy:
        type: ""
  status:
    dockerImageRepository: ""
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    annotations:
      openshift.io/display-name: System MySQL
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-mysql
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
        openshift.io/display-name: System MySQL (latest)
      from:
        kind: ImageStreamTag
        name: ${AMP_RELEASE}
      generation: null
      importPolicy: {}
      name: latest
      referencePolicy:
        type: ""
    - annotations:
        openshift.io/display-name: System ${AMP_RELEASE} MySQL
      from:
        kind: DockerImage
        name: ${SYSTEM_DATABASE_IMAGE}
      generation: null
      importPolicy:
        insecure: ${{IMAGESTREAM_TAG_IMPORT_INSECURE}}
      name: ${AMP_RELEASE}
      referencePolicy:
        type: ""
  status:
    dockerImageRepository: ""


- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: redis
    name: system-redis
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-redis
    strategy:
      resources: {}
      type: Recreate
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-redis
          threescale_component: system
          threescale_component_element: redis
      spec:
        containers:
        - args:
          - /etc/redis.d/redis.conf
          - --daemonize
          - "no"
          command:
          - /opt/rh/rh-redis32/root/usr/bin/redis-server
          image: system-redis:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            initialDelaySeconds: 10
            periodSeconds: 5
            tcpSocket:
              port: 6379
          name: system-redis
          readinessProbe:
            exec:
              command:
              - container-entrypoint
              - bash
              - -c
              - redis-cli set liveness-probe "`date`" | grep OK
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
          resources: {}
          terminationMessagePath: /dev/termination-log
          volumeMounts:
          - mountPath: /var/lib/redis/data
            name: system-redis-storage
          - mountPath: /etc/redis.d/
            name: redis-config
        serviceAccountName: amp
        volumes:
        - name: system-redis-storage
          persistentVolumeClaim:
            claimName: system-redis-storage
        - configMap:
            items:
            - key: redis.conf
              path: redis.conf
            name: redis-config
          name: redis-config
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - system-redis
        from:
          kind: ImageStreamTag
          name: system-redis:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: redis
    name: system-redis-storage
  spec:
    accessModes:
    - ReadWriteOnce
    dataSource: null
    resources:
      requests:
        storage: 1Gi
  status: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: redis
    name: system-redis
  spec:
    ports:
    - name: redis
      port: 6379
      protocol: TCP
      targetPort: 6379
    selector:
      deploymentConfig: system-redis
  status:
    loadBalancer: {}
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    annotations:
      openshift.io/display-name: System Redis
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-redis
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
        openshift.io/display-name: System Redis (latest)
      from:
        kind: ImageStreamTag
        name: ${AMP_RELEASE}
      generation: null
      importPolicy: {}
      name: latest
      referencePolicy:
        type: ""
    - annotations:
        openshift.io/display-name: System ${AMP_RELEASE} Redis
      from:
        kind: DockerImage
        name: ${REDIS_IMAGE}
      generation: null
      importPolicy:
        insecure: ${{IMAGESTREAM_TAG_IMPORT_INSECURE}}
      name: ${AMP_RELEASE}
      referencePolicy:
        type: ""
  status:
    dockerImageRepository: ""
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: mysql
    name: system-mysql
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-mysql
    strategy:
      resources: {}
      type: Recreate
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-mysql
          threescale_component: system
          threescale_component_element: mysql
      spec:
        containers:
        - env:
          - name: MYSQL_USER
            valueFrom:
              secretKeyRef:
                key: DB_USER
                name: system-database
          - name: MYSQL_PASSWORD
            valueFrom:
              secretKeyRef:
                key: DB_PASSWORD
                name: system-database
          - name: MYSQL_DATABASE
            value: ${SYSTEM_DATABASE}
          - name: MYSQL_ROOT_PASSWORD
            value: ${SYSTEM_DATABASE_ROOT_PASSWORD}
          - name: MYSQL_LOWER_CASE_TABLE_NAMES
            value: "1"
          - name: MYSQL_DEFAULTS_FILE
            value: /etc/my-extra/my.cnf
          image: system-mysql:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            initialDelaySeconds: 30
            periodSeconds: 10
            tcpSocket:
              port: 3306
          name: system-mysql
          ports:
          - containerPort: 3306
            protocol: TCP
          readinessProbe:
            exec:
              command:
              - /bin/sh
              - -i
              - -c
              - MYSQL_PWD="$MYSQL_PASSWORD" mysql -h 127.0.0.1 -u $MYSQL_USER -D $MYSQL_DATABASE
                -e 'SELECT 1'
            initialDelaySeconds: 10
            periodSeconds: 30
            timeoutSeconds: 5
          resources: {}
          volumeMounts:
          - mountPath: /var/lib/mysql/data
            name: mysql-storage
          - mountPath: /etc/my-extra.d
            name: mysql-extra-conf
          - mountPath: /etc/my-extra
            name: mysql-main-conf
        serviceAccountName: amp
        volumes:
        - name: mysql-storage
          persistentVolumeClaim:
            claimName: mysql-storage
        - configMap:
            name: mysql-extra-conf
          name: mysql-extra-conf
        - configMap:
            name: mysql-main-conf
          name: mysql-main-conf
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - system-mysql
        from:
          kind: ImageStreamTag
          name: system-mysql:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: mysql
    name: system-mysql
  spec:
    ports:
    - name: system-mysql
      port: 3306
      protocol: TCP
      targetPort: 3306
    selector:
      deploymentConfig: system-mysql
  status:
    loadBalancer: {}
- apiVersion: v1
  data:
    my.cnf: |
      !include /etc/my.cnf
      !includedir /etc/my-extra.d
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: mysql
    name: mysql-main-conf
- apiVersion: v1
  data:
    mysql-charset.cnf: |
      [client]
      default-character-set = utf8

      [mysql]
      default-character-set = utf8

      [mysqld]
      character-set-server = utf8
      collation-server = utf8_unicode_ci
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: mysql
    name: mysql-extra-conf
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: mysql
    name: mysql-storage
  spec:
    accessModes:
    - ReadWriteOnce
    dataSource: null
    resources:
      requests:
        storage: 1Gi
  status: {}
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-database
  stringData:
    DB_PASSWORD: ${SYSTEM_DATABASE_PASSWORD}
    DB_USER: ${SYSTEM_DATABASE_USER}
    URL: mysql2://root:${SYSTEM_DATABASE_ROOT_PASSWORD}@system-mysql/${SYSTEM_DATABASE}
  type: Opaque
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: memcache
    name: system-memcache
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-memcache
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-memcache
          threescale_component: system
          threescale_component_element: memcache
      spec:
        containers:
        - command:
          - memcached
          - -m
          - "64"
          image: system-memcached:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            initialDelaySeconds: 10
            periodSeconds: 10
            tcpSocket:
              port: 11211
          name: memcache
          ports:
          - containerPort: 11211
            protocol: TCP
          readinessProbe:
            initialDelaySeconds: 10
            periodSeconds: 30
            tcpSocket:
              port: 11211
            timeoutSeconds: 5
          resources: {}
        serviceAccountName: amp
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - memcache
        from:
          kind: ImageStreamTag
          name: system-memcached:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: app
    name: system-storage
  spec:
    accessModes:
    - ReadWriteMany
    dataSource: null
    resources:
      requests:
        storage: 100Mi
    storageClassName: ${{RWX_STORAGE_CLASS}}
  status: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: provider-ui
    name: system-provider
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: provider
    selector:
      deploymentConfig: system-app
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: master-ui
    name: system-master
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: master
    selector:
      deploymentConfig: system-app
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: developer-ui
    name: system-developer
  spec:
    ports:
    - name: http
      port: 3000
      protocol: TCP
      targetPort: developer
    selector:
      deploymentConfig: system-app
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: sphinx
    name: system-sphinx
  spec:
    ports:
    - name: sphinx
      port: 9306
      protocol: TCP
      targetPort: 9306
    selector:
      deploymentConfig: system-sphinx
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: memcache
    name: system-memcache
  spec:
    ports:
    - name: memcache
      port: 11211
      protocol: TCP
      targetPort: 11211
    selector:
      deploymentConfig: system-memcache
  status:
    loadBalancer: {}
- apiVersion: v1
  data:
    rolling_updates.yml: |
      production: {}
    service_discovery.yml: |
      production:
        enabled: <%= cluster_token_file_exists = File.exists?(cluster_token_file_path = '/var/run/secrets/kubernetes.io/serviceaccount/token') %>
        server_scheme: 'https'
        server_host: 'kubernetes.default.svc.cluster.local'
        server_port: 443
        bearer_token: "<%= File.read(cluster_token_file_path) if cluster_token_file_exists %>"
        authentication_method: service_account # can be service_account|oauth
        oauth_server_type: builtin # can be builtin|rh_sso
        client_id:
        client_secret:
        timeout: 1
        open_timeout: 1
        max_retry: 5
        verify_ssl: <%= OpenSSL::SSL::VERIFY_NONE %> # 0
    zync.yml: |
      production:
        endpoint: 'http://zync:8080'
        authentication:
          token: "<%= ENV.fetch('ZYNC_AUTHENTICATION_TOKEN') %>"
        connect_timeout: 5
        send_timeout: 5
        receive_timeout: 10
        root_url:
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system
- apiVersion: v1
  data:
    address: ""
    authentication: ""
    domain: ""
    openssl.verify.mode: ""
    password: ""
    port: ""
    username: ""
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: smtp
    name: smtp
- apiVersion: v1
  data:
    AMP_RELEASE: ${AMP_RELEASE}
    APICAST_REGISTRY_URL: ${APICAST_REGISTRY_URL}
    FORCE_SSL: "true"
    PROVIDER_PLAN: enterprise
    RAILS_ENV: production
    RAILS_LOG_LEVEL: info
    RAILS_LOG_TO_STDOUT: "true"
    SSL_CERT_DIR: /etc/pki/tls/certs
    THINKING_SPHINX_PORT: "9306"
    THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE: VERIFY_NONE
    THREESCALE_SUPERDOMAIN: ${WILDCARD_DOMAIN}
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-environment
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: app
    name: system-app
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-app
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        post:
          execNewPod:
            command:
            - bash
            - -c
            - bundle exec rake boot openshift:post_deploy
            containerName: system-master
          failurePolicy: Abort
        pre:
          execNewPod:
            command:
            - bash
            - -c
            - bundle exec rake boot openshift:deploy && bundle exec rake services:create_backend_apis
              services:update_metric_owners proxy:update_proxy_rule_owners
            containerName: system-master
            env:
            - name: AMP_RELEASE
              valueFrom:
                configMapKeyRef:
                  key: AMP_RELEASE
                  name: system-environment
            - name: APICAST_REGISTRY_URL
              valueFrom:
                configMapKeyRef:
                  key: APICAST_REGISTRY_URL
                  name: system-environment
            - name: FORCE_SSL
              valueFrom:
                configMapKeyRef:
                  key: FORCE_SSL
                  name: system-environment
            - name: PROVIDER_PLAN
              valueFrom:
                configMapKeyRef:
                  key: PROVIDER_PLAN
                  name: system-environment
            - name: RAILS_ENV
              valueFrom:
                configMapKeyRef:
                  key: RAILS_ENV
                  name: system-environment
            - name: RAILS_LOG_LEVEL
              valueFrom:
                configMapKeyRef:
                  key: RAILS_LOG_LEVEL
                  name: system-environment
            - name: RAILS_LOG_TO_STDOUT
              valueFrom:
                configMapKeyRef:
                  key: RAILS_LOG_TO_STDOUT
                  name: system-environment
            - name: SSL_CERT_DIR
              valueFrom:
                configMapKeyRef:
                  key: SSL_CERT_DIR
                  name: system-environment
            - name: THINKING_SPHINX_PORT
              valueFrom:
                configMapKeyRef:
                  key: THINKING_SPHINX_PORT
                  name: system-environment
            - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
              valueFrom:
                configMapKeyRef:
                  key: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
                  name: system-environment
            - name: THREESCALE_SUPERDOMAIN
              valueFrom:
                configMapKeyRef:
                  key: THREESCALE_SUPERDOMAIN
                  name: system-environment
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  key: URL
                  name: system-database
            - name: MASTER_DOMAIN
              valueFrom:
                secretKeyRef:
                  key: MASTER_DOMAIN
                  name: system-seed
            - name: MASTER_USER
              valueFrom:
                secretKeyRef:
                  key: MASTER_USER
                  name: system-seed
            - name: MASTER_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: MASTER_PASSWORD
                  name: system-seed
            - name: ADMIN_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ADMIN_ACCESS_TOKEN
                  name: system-seed
            - name: USER_LOGIN
              valueFrom:
                secretKeyRef:
                  key: ADMIN_USER
                  name: system-seed
            - name: USER_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: ADMIN_PASSWORD
                  name: system-seed
            - name: USER_EMAIL
              valueFrom:
                secretKeyRef:
                  key: ADMIN_EMAIL
                  name: system-seed
            - name: TENANT_NAME
              valueFrom:
                secretKeyRef:
                  key: TENANT_NAME
                  name: system-seed
            - name: THINKING_SPHINX_ADDRESS
              value: system-sphinx
            - name: THINKING_SPHINX_CONFIGURATION_FILE
              value: /tmp/sphinx.conf
            - name: EVENTS_SHARED_SECRET
              valueFrom:
                secretKeyRef:
                  key: PASSWORD
                  name: system-events-hook
            - name: RECAPTCHA_PUBLIC_KEY
              valueFrom:
                secretKeyRef:
                  key: PUBLIC_KEY
                  name: system-recaptcha
            - name: RECAPTCHA_PRIVATE_KEY
              valueFrom:
                secretKeyRef:
                  key: PRIVATE_KEY
                  name: system-recaptcha
            - name: SECRET_KEY_BASE
              valueFrom:
                secretKeyRef:
                  key: SECRET_KEY_BASE
                  name: system-app
            - name: MEMCACHE_SERVERS
              valueFrom:
                secretKeyRef:
                  key: SERVERS
                  name: system-memcache
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  key: URL
                  name: system-redis
            - name: MESSAGE_BUS_REDIS_URL
              valueFrom:
                secretKeyRef:
                  key: MESSAGE_BUS_URL
                  name: system-redis
            - name: REDIS_NAMESPACE
              valueFrom:
                secretKeyRef:
                  key: NAMESPACE
                  name: system-redis
            - name: MESSAGE_BUS_REDIS_NAMESPACE
              valueFrom:
                secretKeyRef:
                  key: MESSAGE_BUS_NAMESPACE
                  name: system-redis
            - name: REDIS_SENTINEL_HOSTS
              valueFrom:
                secretKeyRef:
                  key: SENTINEL_HOSTS
                  name: system-redis
            - name: REDIS_SENTINEL_ROLE
              valueFrom:
                secretKeyRef:
                  key: SENTINEL_ROLE
                  name: system-redis
            - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
              valueFrom:
                secretKeyRef:
                  key: MESSAGE_BUS_SENTINEL_HOSTS
                  name: system-redis
            - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
              valueFrom:
                secretKeyRef:
                  key: MESSAGE_BUS_SENTINEL_ROLE
                  name: system-redis
            - name: BACKEND_REDIS_URL
              valueFrom:
                secretKeyRef:
                  key: REDIS_STORAGE_URL
                  name: backend-redis
            - name: BACKEND_REDIS_SENTINEL_HOSTS
              valueFrom:
                secretKeyRef:
                  key: REDIS_STORAGE_SENTINEL_HOSTS
                  name: backend-redis
            - name: BACKEND_REDIS_SENTINEL_ROLE
              valueFrom:
                secretKeyRef:
                  key: REDIS_STORAGE_SENTINEL_ROLE
                  name: backend-redis
            - name: APICAST_BACKEND_ROOT_ENDPOINT
              valueFrom:
                secretKeyRef:
                  key: route_endpoint
                  name: backend-listener
            - name: BACKEND_ROUTE
              valueFrom:
                secretKeyRef:
                  key: route_endpoint
                  name: backend-listener
            - name: SMTP_ADDRESS
              valueFrom:
                configMapKeyRef:
                  key: address
                  name: smtp
            - name: SMTP_USER_NAME
              valueFrom:
                configMapKeyRef:
                  key: username
                  name: smtp
            - name: SMTP_PASSWORD
              valueFrom:
                configMapKeyRef:
                  key: password
                  name: smtp
            - name: SMTP_DOMAIN
              valueFrom:
                configMapKeyRef:
                  key: domain
                  name: smtp
            - name: SMTP_PORT
              valueFrom:
                configMapKeyRef:
                  key: port
                  name: smtp
            - name: SMTP_AUTHENTICATION
              valueFrom:
                configMapKeyRef:
                  key: authentication
                  name: smtp
            - name: SMTP_OPENSSL_VERIFY_MODE
              valueFrom:
                configMapKeyRef:
                  key: openssl.verify.mode
                  name: smtp
            - name: APICAST_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ACCESS_TOKEN
                  name: system-master-apicast
            - name: ZYNC_AUTHENTICATION_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ZYNC_AUTHENTICATION_TOKEN
                  name: zync
            - name: CONFIG_INTERNAL_API_USER
              valueFrom:
                secretKeyRef:
                  key: username
                  name: backend-internal-api
            - name: CONFIG_INTERNAL_API_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: backend-internal-api
            - name: MASTER_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  key: MASTER_ACCESS_TOKEN
                  name: system-seed
            volumes:
            - system-storage
          failurePolicy: Retry
        timeoutSeconds: 1200
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-app
          threescale_component: system
          threescale_component_element: app
      spec:
        containers:
        - args:
          - env
          - TENANT_MODE=master
          - PORT=3002
          - container-entrypoint
          - bundle
          - exec
          - unicorn
          - -c
          - config/unicorn.rb
          env:
          - name: AMP_RELEASE
            valueFrom:
              configMapKeyRef:
                key: AMP_RELEASE
                name: system-environment
          - name: APICAST_REGISTRY_URL
            valueFrom:
              configMapKeyRef:
                key: APICAST_REGISTRY_URL
                name: system-environment
          - name: FORCE_SSL
            valueFrom:
              configMapKeyRef:
                key: FORCE_SSL
                name: system-environment
          - name: PROVIDER_PLAN
            valueFrom:
              configMapKeyRef:
                key: PROVIDER_PLAN
                name: system-environment
          - name: RAILS_ENV
            valueFrom:
              configMapKeyRef:
                key: RAILS_ENV
                name: system-environment
          - name: RAILS_LOG_LEVEL
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_LEVEL
                name: system-environment
          - name: RAILS_LOG_TO_STDOUT
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_TO_STDOUT
                name: system-environment
          - name: SSL_CERT_DIR
            valueFrom:
              configMapKeyRef:
                key: SSL_CERT_DIR
                name: system-environment
          - name: THINKING_SPHINX_PORT
            valueFrom:
              configMapKeyRef:
                key: THINKING_SPHINX_PORT
                name: system-environment
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
                name: system-environment
          - name: THREESCALE_SUPERDOMAIN
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SUPERDOMAIN
                name: system-environment
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-database
          - name: MASTER_DOMAIN
            valueFrom:
              secretKeyRef:
                key: MASTER_DOMAIN
                name: system-seed
          - name: MASTER_USER
            valueFrom:
              secretKeyRef:
                key: MASTER_USER
                name: system-seed
          - name: MASTER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: MASTER_PASSWORD
                name: system-seed
          - name: ADMIN_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ADMIN_ACCESS_TOKEN
                name: system-seed
          - name: USER_LOGIN
            valueFrom:
              secretKeyRef:
                key: ADMIN_USER
                name: system-seed
          - name: USER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ADMIN_PASSWORD
                name: system-seed
          - name: USER_EMAIL
            valueFrom:
              secretKeyRef:
                key: ADMIN_EMAIL
                name: system-seed
          - name: TENANT_NAME
            valueFrom:
              secretKeyRef:
                key: TENANT_NAME
                name: system-seed
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            valueFrom:
              secretKeyRef:
                key: PASSWORD
                name: system-events-hook
          - name: RECAPTCHA_PUBLIC_KEY
            valueFrom:
              secretKeyRef:
                key: PUBLIC_KEY
                name: system-recaptcha
          - name: RECAPTCHA_PRIVATE_KEY
            valueFrom:
              secretKeyRef:
                key: PRIVATE_KEY
                name: system-recaptcha
          - name: SECRET_KEY_BASE
            valueFrom:
              secretKeyRef:
                key: SECRET_KEY_BASE
                name: system-app
          - name: MEMCACHE_SERVERS
            valueFrom:
              secretKeyRef:
                key: SERVERS
                name: system-memcache
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          - name: BACKEND_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_URL
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_HOSTS
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_ROLE
                name: backend-redis
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: BACKEND_ROUTE
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: APICAST_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ACCESS_TOKEN
                name: system-master-apicast
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: CONFIG_INTERNAL_API_USER
            valueFrom:
              secretKeyRef:
                key: username
                name: backend-internal-api
          - name: CONFIG_INTERNAL_API_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: backend-internal-api
          image: amp-system:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 40
            initialDelaySeconds: 40
            periodSeconds: 10
            tcpSocket:
              port: master
            timeoutSeconds: 10
          name: system-master
          ports:
          - containerPort: 3002
            name: master
            protocol: TCP
          readinessProbe:
            failureThreshold: 10
            httpGet:
              httpHeaders:
              - name: X-Forwarded-Proto
                value: https
              path: /check.txt
              port: master
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 30
            timeoutSeconds: 10
          resources: {}
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
          - mountPath: /opt/system-extra-configs
            name: system-config
        - args:
          - env
          - TENANT_MODE=provider
          - PORT=3000
          - container-entrypoint
          - bundle
          - exec
          - unicorn
          - -c
          - config/unicorn.rb
          env:
          - name: AMP_RELEASE
            valueFrom:
              configMapKeyRef:
                key: AMP_RELEASE
                name: system-environment
          - name: APICAST_REGISTRY_URL
            valueFrom:
              configMapKeyRef:
                key: APICAST_REGISTRY_URL
                name: system-environment
          - name: FORCE_SSL
            valueFrom:
              configMapKeyRef:
                key: FORCE_SSL
                name: system-environment
          - name: PROVIDER_PLAN
            valueFrom:
              configMapKeyRef:
                key: PROVIDER_PLAN
                name: system-environment
          - name: RAILS_ENV
            valueFrom:
              configMapKeyRef:
                key: RAILS_ENV
                name: system-environment
          - name: RAILS_LOG_LEVEL
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_LEVEL
                name: system-environment
          - name: RAILS_LOG_TO_STDOUT
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_TO_STDOUT
                name: system-environment
          - name: SSL_CERT_DIR
            valueFrom:
              configMapKeyRef:
                key: SSL_CERT_DIR
                name: system-environment
          - name: THINKING_SPHINX_PORT
            valueFrom:
              configMapKeyRef:
                key: THINKING_SPHINX_PORT
                name: system-environment
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
                name: system-environment
          - name: THREESCALE_SUPERDOMAIN
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SUPERDOMAIN
                name: system-environment
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-database
          - name: MASTER_DOMAIN
            valueFrom:
              secretKeyRef:
                key: MASTER_DOMAIN
                name: system-seed
          - name: MASTER_USER
            valueFrom:
              secretKeyRef:
                key: MASTER_USER
                name: system-seed
          - name: MASTER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: MASTER_PASSWORD
                name: system-seed
          - name: ADMIN_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ADMIN_ACCESS_TOKEN
                name: system-seed
          - name: USER_LOGIN
            valueFrom:
              secretKeyRef:
                key: ADMIN_USER
                name: system-seed
          - name: USER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ADMIN_PASSWORD
                name: system-seed
          - name: USER_EMAIL
            valueFrom:
              secretKeyRef:
                key: ADMIN_EMAIL
                name: system-seed
          - name: TENANT_NAME
            valueFrom:
              secretKeyRef:
                key: TENANT_NAME
                name: system-seed
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            valueFrom:
              secretKeyRef:
                key: PASSWORD
                name: system-events-hook
          - name: RECAPTCHA_PUBLIC_KEY
            valueFrom:
              secretKeyRef:
                key: PUBLIC_KEY
                name: system-recaptcha
          - name: RECAPTCHA_PRIVATE_KEY
            valueFrom:
              secretKeyRef:
                key: PRIVATE_KEY
                name: system-recaptcha
          - name: SECRET_KEY_BASE
            valueFrom:
              secretKeyRef:
                key: SECRET_KEY_BASE
                name: system-app
          - name: MEMCACHE_SERVERS
            valueFrom:
              secretKeyRef:
                key: SERVERS
                name: system-memcache
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          - name: BACKEND_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_URL
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_HOSTS
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_ROLE
                name: backend-redis
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: BACKEND_ROUTE
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: APICAST_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ACCESS_TOKEN
                name: system-master-apicast
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: CONFIG_INTERNAL_API_USER
            valueFrom:
              secretKeyRef:
                key: username
                name: backend-internal-api
          - name: CONFIG_INTERNAL_API_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: backend-internal-api
          image: amp-system:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 40
            initialDelaySeconds: 40
            periodSeconds: 10
            tcpSocket:
              port: provider
            timeoutSeconds: 10
          name: system-provider
          ports:
          - containerPort: 3000
            name: provider
            protocol: TCP
          readinessProbe:
            failureThreshold: 10
            httpGet:
              httpHeaders:
              - name: X-Forwarded-Proto
                value: https
              path: /check.txt
              port: provider
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 30
            timeoutSeconds: 10
          resources: {}
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
          - mountPath: /opt/system-extra-configs
            name: system-config
        - args:
          - env
          - PORT=3001
          - container-entrypoint
          - bundle
          - exec
          - unicorn
          - -c
          - config/unicorn.rb
          env:
          - name: AMP_RELEASE
            valueFrom:
              configMapKeyRef:
                key: AMP_RELEASE
                name: system-environment
          - name: APICAST_REGISTRY_URL
            valueFrom:
              configMapKeyRef:
                key: APICAST_REGISTRY_URL
                name: system-environment
          - name: FORCE_SSL
            valueFrom:
              configMapKeyRef:
                key: FORCE_SSL
                name: system-environment
          - name: PROVIDER_PLAN
            valueFrom:
              configMapKeyRef:
                key: PROVIDER_PLAN
                name: system-environment
          - name: RAILS_ENV
            valueFrom:
              configMapKeyRef:
                key: RAILS_ENV
                name: system-environment
          - name: RAILS_LOG_LEVEL
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_LEVEL
                name: system-environment
          - name: RAILS_LOG_TO_STDOUT
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_TO_STDOUT
                name: system-environment
          - name: SSL_CERT_DIR
            valueFrom:
              configMapKeyRef:
                key: SSL_CERT_DIR
                name: system-environment
          - name: THINKING_SPHINX_PORT
            valueFrom:
              configMapKeyRef:
                key: THINKING_SPHINX_PORT
                name: system-environment
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
                name: system-environment
          - name: THREESCALE_SUPERDOMAIN
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SUPERDOMAIN
                name: system-environment
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-database
          - name: MASTER_DOMAIN
            valueFrom:
              secretKeyRef:
                key: MASTER_DOMAIN
                name: system-seed
          - name: MASTER_USER
            valueFrom:
              secretKeyRef:
                key: MASTER_USER
                name: system-seed
          - name: MASTER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: MASTER_PASSWORD
                name: system-seed
          - name: ADMIN_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ADMIN_ACCESS_TOKEN
                name: system-seed
          - name: USER_LOGIN
            valueFrom:
              secretKeyRef:
                key: ADMIN_USER
                name: system-seed
          - name: USER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ADMIN_PASSWORD
                name: system-seed
          - name: USER_EMAIL
            valueFrom:
              secretKeyRef:
                key: ADMIN_EMAIL
                name: system-seed
          - name: TENANT_NAME
            valueFrom:
              secretKeyRef:
                key: TENANT_NAME
                name: system-seed
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            valueFrom:
              secretKeyRef:
                key: PASSWORD
                name: system-events-hook
          - name: RECAPTCHA_PUBLIC_KEY
            valueFrom:
              secretKeyRef:
                key: PUBLIC_KEY
                name: system-recaptcha
          - name: RECAPTCHA_PRIVATE_KEY
            valueFrom:
              secretKeyRef:
                key: PRIVATE_KEY
                name: system-recaptcha
          - name: SECRET_KEY_BASE
            valueFrom:
              secretKeyRef:
                key: SECRET_KEY_BASE
                name: system-app
          - name: MEMCACHE_SERVERS
            valueFrom:
              secretKeyRef:
                key: SERVERS
                name: system-memcache
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          - name: BACKEND_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_URL
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_HOSTS
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_ROLE
                name: backend-redis
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: BACKEND_ROUTE
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: APICAST_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ACCESS_TOKEN
                name: system-master-apicast
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: CONFIG_INTERNAL_API_USER
            valueFrom:
              secretKeyRef:
                key: username
                name: backend-internal-api
          - name: CONFIG_INTERNAL_API_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: backend-internal-api
          image: amp-system:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 40
            initialDelaySeconds: 40
            periodSeconds: 10
            tcpSocket:
              port: developer
            timeoutSeconds: 10
          name: system-developer
          ports:
          - containerPort: 3001
            name: developer
            protocol: TCP
          readinessProbe:
            failureThreshold: 10
            httpGet:
              httpHeaders:
              - name: X-Forwarded-Proto
                value: https
              path: /check.txt
              port: developer
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 30
            timeoutSeconds: 10
          resources: {}
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
            readOnly: true
          - mountPath: /opt/system-extra-configs
            name: system-config
        serviceAccountName: amp
        volumes:
        - name: system-storage
          persistentVolumeClaim:
            claimName: system-storage
        - configMap:
            items:
            - key: zync.yml
              path: zync.yml
            - key: rolling_updates.yml
              path: rolling_updates.yml
            - key: service_discovery.yml
              path: service_discovery.yml
            name: system
          name: system-config
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - system-provider
        - system-developer
        - system-master
        from:
          kind: ImageStreamTag
          name: amp-system:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: sidekiq
    name: system-sidekiq
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-sidekiq
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1200
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-sidekiq
          threescale_component: system
          threescale_component_element: sidekiq
      spec:
        containers:
        - args:
          - rake
          - sidekiq:worker
          - RAILS_MAX_THREADS=25
          env:
          - name: AMP_RELEASE
            valueFrom:
              configMapKeyRef:
                key: AMP_RELEASE
                name: system-environment
          - name: APICAST_REGISTRY_URL
            valueFrom:
              configMapKeyRef:
                key: APICAST_REGISTRY_URL
                name: system-environment
          - name: FORCE_SSL
            valueFrom:
              configMapKeyRef:
                key: FORCE_SSL
                name: system-environment
          - name: PROVIDER_PLAN
            valueFrom:
              configMapKeyRef:
                key: PROVIDER_PLAN
                name: system-environment
          - name: RAILS_ENV
            valueFrom:
              configMapKeyRef:
                key: RAILS_ENV
                name: system-environment
          - name: RAILS_LOG_LEVEL
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_LEVEL
                name: system-environment
          - name: RAILS_LOG_TO_STDOUT
            valueFrom:
              configMapKeyRef:
                key: RAILS_LOG_TO_STDOUT
                name: system-environment
          - name: SSL_CERT_DIR
            valueFrom:
              configMapKeyRef:
                key: SSL_CERT_DIR
                name: system-environment
          - name: THINKING_SPHINX_PORT
            valueFrom:
              configMapKeyRef:
                key: THINKING_SPHINX_PORT
                name: system-environment
          - name: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SANDBOX_PROXY_OPENSSL_VERIFY_MODE
                name: system-environment
          - name: THREESCALE_SUPERDOMAIN
            valueFrom:
              configMapKeyRef:
                key: THREESCALE_SUPERDOMAIN
                name: system-environment
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-database
          - name: MASTER_DOMAIN
            valueFrom:
              secretKeyRef:
                key: MASTER_DOMAIN
                name: system-seed
          - name: MASTER_USER
            valueFrom:
              secretKeyRef:
                key: MASTER_USER
                name: system-seed
          - name: MASTER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: MASTER_PASSWORD
                name: system-seed
          - name: ADMIN_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ADMIN_ACCESS_TOKEN
                name: system-seed
          - name: USER_LOGIN
            valueFrom:
              secretKeyRef:
                key: ADMIN_USER
                name: system-seed
          - name: USER_PASSWORD
            valueFrom:
              secretKeyRef:
                key: ADMIN_PASSWORD
                name: system-seed
          - name: USER_EMAIL
            valueFrom:
              secretKeyRef:
                key: ADMIN_EMAIL
                name: system-seed
          - name: TENANT_NAME
            valueFrom:
              secretKeyRef:
                key: TENANT_NAME
                name: system-seed
          - name: THINKING_SPHINX_ADDRESS
            value: system-sphinx
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: /tmp/sphinx.conf
          - name: EVENTS_SHARED_SECRET
            valueFrom:
              secretKeyRef:
                key: PASSWORD
                name: system-events-hook
          - name: RECAPTCHA_PUBLIC_KEY
            valueFrom:
              secretKeyRef:
                key: PUBLIC_KEY
                name: system-recaptcha
          - name: RECAPTCHA_PRIVATE_KEY
            valueFrom:
              secretKeyRef:
                key: PRIVATE_KEY
                name: system-recaptcha
          - name: SECRET_KEY_BASE
            valueFrom:
              secretKeyRef:
                key: SECRET_KEY_BASE
                name: system-app
          - name: MEMCACHE_SERVERS
            valueFrom:
              secretKeyRef:
                key: SERVERS
                name: system-memcache
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          - name: BACKEND_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_URL
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_HOSTS
                name: backend-redis
          - name: BACKEND_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: REDIS_STORAGE_SENTINEL_ROLE
                name: backend-redis
          - name: APICAST_BACKEND_ROOT_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: BACKEND_ROUTE
            valueFrom:
              secretKeyRef:
                key: route_endpoint
                name: backend-listener
          - name: SMTP_ADDRESS
            valueFrom:
              configMapKeyRef:
                key: address
                name: smtp
          - name: SMTP_USER_NAME
            valueFrom:
              configMapKeyRef:
                key: username
                name: smtp
          - name: SMTP_PASSWORD
            valueFrom:
              configMapKeyRef:
                key: password
                name: smtp
          - name: SMTP_DOMAIN
            valueFrom:
              configMapKeyRef:
                key: domain
                name: smtp
          - name: SMTP_PORT
            valueFrom:
              configMapKeyRef:
                key: port
                name: smtp
          - name: SMTP_AUTHENTICATION
            valueFrom:
              configMapKeyRef:
                key: authentication
                name: smtp
          - name: SMTP_OPENSSL_VERIFY_MODE
            valueFrom:
              configMapKeyRef:
                key: openssl.verify.mode
                name: smtp
          - name: APICAST_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: ACCESS_TOKEN
                name: system-master-apicast
          - name: ZYNC_AUTHENTICATION_TOKEN
            valueFrom:
              secretKeyRef:
                key: ZYNC_AUTHENTICATION_TOKEN
                name: zync
          - name: CONFIG_INTERNAL_API_USER
            valueFrom:
              secretKeyRef:
                key: username
                name: backend-internal-api
          - name: CONFIG_INTERNAL_API_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: backend-internal-api
          image: amp-system:latest
          imagePullPolicy: IfNotPresent
          name: system-sidekiq
          resources: {}
          volumeMounts:
          - mountPath: /opt/system/public/system
            name: system-storage
          - mountPath: /tmp
            name: system-tmp
          - mountPath: /opt/system-extra-configs
            name: system-config
        initContainers:
        - command:
          - bash
          - -c
          - bundle exec sh -c "until rake boot:redis && curl --output /dev/null --silent
            --fail --head http://system-master:3000/status; do sleep $SLEEP_SECONDS;
            done"
          env:
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          - name: SLEEP_SECONDS
            value: "1"
          image: amp-system:latest
          name: check-svc
          resources: {}
        serviceAccountName: amp
        volumes:
        - emptyDir:
            medium: Memory
          name: system-tmp
        - name: system-storage
          persistentVolumeClaim:
            claimName: system-storage
        - configMap:
            items:
            - key: zync.yml
              path: zync.yml
            - key: rolling_updates.yml
              path: rolling_updates.yml
            - key: service_discovery.yml
              path: service_discovery.yml
            name: system
          name: system-config
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - check-svc
        - system-sidekiq
        from:
          kind: ImageStreamTag
          name: amp-system:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
      threescale_component_element: sphinx
    name: system-sphinx
  spec:
    replicas: 1
    selector:
      deploymentConfig: system-sphinx
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1200
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: system-sphinx
          threescale_component: system
          threescale_component_element: sphinx
      spec:
        containers:
        - args:
          - rake
          - openshift:thinking_sphinx:start
          env:
          - name: RAILS_ENV
            valueFrom:
              configMapKeyRef:
                key: RAILS_ENV
                name: system-environment
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-database
          - name: THINKING_SPHINX_ADDRESS
            value: 0.0.0.0
          - name: THINKING_SPHINX_CONFIGURATION_FILE
            value: db/sphinx/production.conf
          - name: THINKING_SPHINX_PID_FILE
            value: db/sphinx/searchd.pid
          - name: DELTA_INDEX_INTERVAL
            value: "5"
          - name: FULL_REINDEX_INTERVAL
            value: "60"
          - name: REDIS_URL
            valueFrom:
              secretKeyRef:
                key: URL
                name: system-redis
          - name: MESSAGE_BUS_REDIS_URL
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_URL
                name: system-redis
          - name: REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: NAMESPACE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_NAMESPACE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_NAMESPACE
                name: system-redis
          - name: REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: SENTINEL_HOSTS
                name: system-redis
          - name: REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: SENTINEL_ROLE
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_HOSTS
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_HOSTS
                name: system-redis
          - name: MESSAGE_BUS_REDIS_SENTINEL_ROLE
            valueFrom:
              secretKeyRef:
                key: MESSAGE_BUS_SENTINEL_ROLE
                name: system-redis
          image: amp-system:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            initialDelaySeconds: 60
            periodSeconds: 10
            tcpSocket:
              port: 9306
          name: system-sphinx
          resources: {}
          volumeMounts:
          - mountPath: /opt/system/db/sphinx
            name: system-sphinx-database
        initContainers:
        - command:
          - sh
          - -c
          - until $(curl --output /dev/null --silent --fail --head http://system-master:3000/status);
            do sleep $SLEEP_SECONDS; done
          env:
          - name: SLEEP_SECONDS
            value: "1"
          image: amp-system:latest
          name: system-master-svc
          resources: {}
        serviceAccountName: amp
        volumes:
        - emptyDir: {}
          name: system-sphinx-database
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - system-master-svc
        - system-sphinx
        from:
          kind: ImageStreamTag
          name: amp-system:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-events-hook
  stringData:
    PASSWORD: ${SYSTEM_BACKEND_SHARED_SECRET}
    URL: http://system-master:3000/master/events/import
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-redis
  stringData:
    MESSAGE_BUS_NAMESPACE: ${SYSTEM_MESSAGE_BUS_REDIS_NAMESPACE}
    MESSAGE_BUS_SENTINEL_HOSTS: ""
    MESSAGE_BUS_SENTINEL_ROLE: ""
    MESSAGE_BUS_URL: ${SYSTEM_MESSAGE_BUS_REDIS_URL}
    NAMESPACE: ${SYSTEM_REDIS_NAMESPACE}
    SENTINEL_HOSTS: ""
    SENTINEL_ROLE: ""
    URL: ${SYSTEM_REDIS_URL}
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-master-apicast
  stringData:
    ACCESS_TOKEN: ${APICAST_ACCESS_TOKEN}
    BASE_URL: http://${APICAST_ACCESS_TOKEN}@system-master:3000
    PROXY_CONFIGS_ENDPOINT: http://${APICAST_ACCESS_TOKEN}@system-master:3000/master/api/proxy/configs
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-seed
  stringData:
    ADMIN_ACCESS_TOKEN: ${ADMIN_ACCESS_TOKEN}
    ADMIN_EMAIL: ${ADMIN_EMAIL}
    ADMIN_PASSWORD: ${ADMIN_PASSWORD}
    ADMIN_USER: ${ADMIN_USERNAME}
    MASTER_ACCESS_TOKEN: ${MASTER_ACCESS_TOKEN}
    MASTER_DOMAIN: ${MASTER_NAME}
    MASTER_PASSWORD: ${MASTER_PASSWORD}
    MASTER_USER: ${MASTER_USER}
    TENANT_NAME: ${TENANT_NAME}
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-recaptcha
  stringData:
    PRIVATE_KEY: ${RECAPTCHA_PRIVATE_KEY}
    PUBLIC_KEY: ${RECAPTCHA_PUBLIC_KEY}
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-app
  stringData:
    SECRET_KEY_BASE: ${SYSTEM_APP_SECRET_KEY_BASE}
  type: Opaque
- apiVersion: v1
  kind: Secret
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: system
    name: system-memcache
  stringData:
    SERVERS: system-memcache:11211
  type: Opaque
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
      threescale_component_element: staging
    name: apicast-staging
  spec:
    replicas: 1
    selector:
      deploymentConfig: apicast-staging
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1800
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          prometheus.io/port: "9421"
          prometheus.io/scrape: "true"
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: apicast-staging
          threescale_component: apicast
          threescale_component_element: staging
      spec:
        containers:
        - env:
          - name: THREESCALE_PORTAL_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: PROXY_CONFIGS_ENDPOINT
                name: system-master-apicast
          - name: BACKEND_ENDPOINT_OVERRIDE
            valueFrom:
              secretKeyRef:
                key: service_endpoint
                name: backend-listener
          - name: APICAST_MANAGEMENT_API
            valueFrom:
              configMapKeyRef:
                key: APICAST_MANAGEMENT_API
                name: apicast-environment
          - name: OPENSSL_VERIFY
            valueFrom:
              configMapKeyRef:
                key: OPENSSL_VERIFY
                name: apicast-environment
          - name: APICAST_RESPONSE_CODES
            valueFrom:
              configMapKeyRef:
                key: APICAST_RESPONSE_CODES
                name: apicast-environment
          - name: APICAST_CONFIGURATION_LOADER
            value: lazy
          - name: APICAST_CONFIGURATION_CACHE
            value: "0"
          - name: THREESCALE_DEPLOYMENT_ENV
            value: staging
          image: amp-apicast:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            httpGet:
              path: /status/live
              port: 8090
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 5
          name: apicast-staging
          ports:
          - containerPort: 8080
            protocol: TCP
          - containerPort: 8090
            protocol: TCP
          - containerPort: 9421
            name: metrics
            protocol: TCP
          readinessProbe:
            httpGet:
              path: /status/ready
              port: 8090
            initialDelaySeconds: 15
            periodSeconds: 30
            timeoutSeconds: 5
          resources: {}
        serviceAccountName: amp
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - apicast-staging
        from:
          kind: ImageStreamTag
          name: amp-apicast:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: apps.openshift.io/v1
  kind: DeploymentConfig
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
      threescale_component_element: production
    name: apicast-production
  spec:
    replicas: 1
    selector:
      deploymentConfig: apicast-production
    strategy:
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 1800
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        annotations:
          prometheus.io/port: "9421"
          prometheus.io/scrape: "true"
        creationTimestamp: null
        labels:
          app: ${APP_LABEL}
          deploymentConfig: apicast-production
          threescale_component: apicast
          threescale_component_element: production
      spec:
        containers:
        - env:
          - name: THREESCALE_PORTAL_ENDPOINT
            valueFrom:
              secretKeyRef:
                key: PROXY_CONFIGS_ENDPOINT
                name: system-master-apicast
          - name: BACKEND_ENDPOINT_OVERRIDE
            valueFrom:
              secretKeyRef:
                key: service_endpoint
                name: backend-listener
          - name: APICAST_MANAGEMENT_API
            valueFrom:
              configMapKeyRef:
                key: APICAST_MANAGEMENT_API
                name: apicast-environment
          - name: OPENSSL_VERIFY
            valueFrom:
              configMapKeyRef:
                key: OPENSSL_VERIFY
                name: apicast-environment
          - name: APICAST_RESPONSE_CODES
            valueFrom:
              configMapKeyRef:
                key: APICAST_RESPONSE_CODES
                name: apicast-environment
          - name: APICAST_CONFIGURATION_LOADER
            value: boot
          - name: APICAST_CONFIGURATION_CACHE
            value: "300"
          - name: THREESCALE_DEPLOYMENT_ENV
            value: production
          image: amp-apicast:latest
          imagePullPolicy: IfNotPresent
          livenessProbe:
            httpGet:
              path: /status/live
              port: 8090
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 5
          name: apicast-production
          ports:
          - containerPort: 8080
            protocol: TCP
          - containerPort: 8090
            protocol: TCP
          - containerPort: 9421
            name: metrics
            protocol: TCP
          readinessProbe:
            httpGet:
              path: /status/ready
              port: 8090
            initialDelaySeconds: 15
            periodSeconds: 30
            timeoutSeconds: 5
          resources: {}
        initContainers:
        - command:
          - sh
          - -c
          - until $(curl --output /dev/null --silent --fail --head http://system-master:3000/status);
            do sleep $SLEEP_SECONDS; done
          env:
          - name: SLEEP_SECONDS
            value: "1"
          image: amp-apicast:latest
          name: system-master-svc
          resources: {}
        serviceAccountName: amp
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - system-master-svc
        - apicast-production
        from:
          kind: ImageStreamTag
          name: amp-apicast:latest
      type: ImageChange
  status:
    availableReplicas: 0
    latestVersion: 0
    observedGeneration: 0
    replicas: 0
    unavailableReplicas: 0
    updatedReplicas: 0
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
      threescale_component_element: staging
    name: apicast-staging
  spec:
    ports:
    - name: gateway
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: management
      port: 8090
      protocol: TCP
      targetPort: 8090
    selector:
      deploymentConfig: apicast-staging
  status:
    loadBalancer: {}
- apiVersion: v1
  kind: Service
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
      threescale_component_element: production
    name: apicast-production
  spec:
    ports:
    - name: gateway
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: management
      port: 8090
      protocol: TCP
      targetPort: 8090
    selector:
      deploymentConfig: apicast-production
  status:
    loadBalancer: {}
- apiVersion: v1
  data:
    APICAST_MANAGEMENT_API: ${APICAST_MANAGEMENT_API}
    APICAST_RESPONSE_CODES: ${APICAST_RESPONSE_CODES}
    OPENSSL_VERIFY: ${APICAST_OPENSSL_VERIFY}
  kind: ConfigMap
  metadata:
    creationTimestamp: null
    labels:
      app: ${APP_LABEL}
      threescale_component: apicast
    name: apicast-environment
parameters:
